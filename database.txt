CREATE DATABASE bookstoredb;

USE bookstoredb;

CREATE TABLE books (book_id INTEGER NOT NULL AUTO_INCREMENT, authors VARCHAR(255) NOT NULL, book_cover LONGBLOB, description VARCHAR(2000), book_file LONGBLOB, hidden BIT NOT NULL, isbn VARCHAR(25) NOT NULL, language VARCHAR(255) NOT NULL, number_of_pages INTEGER NOT NULL, price DOUBLE PRECISION NOT NULL, publisher VARCHAR(255) NOT NULL, title VARCHAR(255) NOT NULL, year_of_publication INTEGER NOT NULL, PRIMARY KEY (book_id)) ENGINE=InnoDB;
CREATE TABLE books2 (book2_id INTEGER NOT NULL AUTO_INCREMENT, authors VARCHAR(255) NOT NULL, book_cover LONGBLOB, description VARCHAR(2000), book_file LONGBLOB, isbn VARCHAR(25) NOT NULL, language VARCHAR(255) NOT NULL, number_of_pages INTEGER NOT NULL, price DOUBLE PRECISION NOT NULL, publisher VARCHAR(255) NOT NULL, title VARCHAR(255) NOT NULL, year_of_publication INTEGER NOT NULL, PRIMARY KEY (book2_id)) ENGINE=InnoDB;
CREATE TABLE orders (order_id INTEGER NOT NULL AUTO_INCREMENT, date DATETIME(6) NOT NULL, order_payment_id VARCHAR(128) NOT NULL, price DOUBLE PRECISION NOT NULL, status VARCHAR(255) NOT NULL, user_id INTEGER, PRIMARY KEY (order_id)) ENGINE=InnoDB;
CREATE TABLE orders_books2 (order_id INTEGER NOT NULL, book2_id INTEGER NOT NULL, PRIMARY KEY (order_id, book2_id)) ENGINE=InnoDB;
CREATE TABLE roles (role_id INTEGER NOT NULL AUTO_INCREMENT, name VARCHAR(255), PRIMARY KEY (role_id)) ENGINE=InnoDB;
CREATE TABLE users (user_id INTEGER NOT NULL AUTO_INCREMENT, first_name VARCHAR(100) NOT NULL, last_name VARCHAR(100) NOT NULL, password VARCHAR(255) NOT NULL, username VARCHAR(100) NOT NULL, PRIMARY KEY (user_id)) ENGINE=InnoDB;
CREATE TABLE users_books2 (user_id INTEGER NOT NULL, book2_id INTEGER NOT NULL, PRIMARY KEY (user_id, book2_id)) ENGINE=InnoDB;
CREATE TABLE users_roles (user_id INTEGER NOT NULL, role_id INTEGER NOT NULL, PRIMARY KEY (user_id, role_id)) ENGINE=InnoDB;

ALTER TABLE users ADD CONSTRAINT UK_r43af9ap4edm43mmtq01oddj6 UNIQUE (username);
ALTER TABLE orders ADD CONSTRAINT FK32ql8ubntj5uh44ph9659tiih FOREIGN KEY (user_id) REFERENCES users (user_id);
ALTER TABLE orders_books2 ADD CONSTRAINT FKjnik2ikdp16hnr7blwhklhmws FOREIGN KEY (book2_id) REFERENCES books2 (book2_id);
ALTER TABLE orders_books2 ADD CONSTRAINT FKy8nw36vnixey53cm0deyixy8 FOREIGN KEY (order_id) REFERENCES orders (order_id);
ALTER TABLE users_books2 ADD CONSTRAINT FK9u9743kjyl94gip6sd4blyoc9 FOREIGN KEY (book2_id) REFERENCES books2 (book2_id);
ALTER TABLE users_books2 ADD CONSTRAINT FKp6hevgjd4la3j8ojudm7kfxkt FOREIGN KEY (user_id) REFERENCES users (user_id);
ALTER TABLE users_roles ADD CONSTRAINT FKj6m8fwv7oqv74fcehir1a9ffy FOREIGN KEY (role_id) REFERENCES roles (role_id);
ALTER TABLE users_roles ADD CONSTRAINT FK2o0jvgh89lemvvo17cbqvdxaa FOREIGN KEY (user_id) REFERENCES users (user_id);

INSERT INTO users(first_name, last_name, username, password) VALUES("Superadmin", "Superadmin", "superadmin", "$2a$10$GhQk4Q9GF9IWmGsrW/cB2unmdra92IbJK2MFfm1JEHuXlBnwrG6bS");
INSERT INTO users(first_name, last_name, username, password) VALUES("Admin", "Admin", "admin", "$2a$10$9cqO5yS4ExYrc5emsysKY.ccfVqCLqlm459WHTg7Rtps4pYtQ/Ix6");
INSERT INTO roles(name) VALUES("Admin");
INSERT INTO roles(name) VALUES("UÅ¼ytkownik");
INSERT INTO users_roles(user_id, role_id) VALUES(1, 1);
INSERT INTO users_roles(user_id, role_id) VALUES(1, 2);
INSERT INTO users_roles(user_id, role_id) VALUES(2, 1);
